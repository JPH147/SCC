<mat-card class="card-principal">

  <mat-card-title>
    <div id = "tituloProd"> Salida de vendedores </div>
  </mat-card-title>

  <form [formGroup]="SalidaVendedoresForm" (ngSubmit)="Guardar(SalidaVendedoresForm)">

  <mat-card-content>
    <mat-card class="CabeceraSalidaVendedor">
      <mat-card-header>
        <mat-card-title id ="CabeceraVendedor ">
          Datos Generales
        </mat-card-title>
      </mat-card-header>
      <mat-grid-list cols="3" rowHeight="85px">

        <mat-grid-tile>
          <mat-form-field class="formulario-principal">
            <input matInput placeholder="Pecosa" formControlName="pecosa">
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile>
          <mat-form-field class="formulario-principal">
            <mat-select placeholder="Sucursal" formControlName="sucursal">
              <mat-option *ngFor="let sucursal of Sucursales" [value]="sucursal.id">{{sucursal.nombre}}</mat-option>
            </mat-select>
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile>
          <mat-form-field class="formulario-principal">
            <input matInput [matDatepicker]="picker" placeholder="Fecha de Salida"  formControlName="fecha_salida">
            <mat-datepicker-toggle matSuffix [for]="picker" ></mat-datepicker-toggle>
            <mat-datepicker #picker ></mat-datepicker>
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile>
          <mat-form-field class="formulario-principal">
            <mat-chip-list #chipList>
             <mat-chip *ngFor="let departamento of departamentos" [selectable]="true" [removable]="true" (removed)="remove(departamento)">
               {{departamento.name}}
               <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
             </mat-chip>
             <input placeholder="Destino"
                    formControlName="destino"
                    [matChipInputFor]="chipList"
                    [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                    [matChipInputAddOnBlur]="true"
                    (matChipInputTokenEnd)="add($event)">
            </mat-chip-list>
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile>
            <mat-form-field class="formulario-principal">
              <input matInput #message maxlength="15" placeholder="Guia de remisiÃ³n" formControlName="guia_remision">
            </mat-form-field>
          </mat-grid-tile>

          <mat-grid-tile>
            <button mat-raised-button type="button" (click)="AgregarTalonario()"> Ingresar Talonarios</button>
            </mat-grid-tile>
          </mat-grid-list>
    </mat-card>
  </mat-card-content>

  <mat-card-content>
    
    <mat-card class="CabeceraSalidaVendedor">

      <mat-grid-list cols="1" rowHeight="55px">
        <mat-grid-tile>
          <mat-checkbox formControlName="tipo_movilidad" color="primary" (change)="ActivarMovilidad($event)"> Vehiculo de la Empresa</mat-checkbox>
        </mat-grid-tile>
      </mat-grid-list>

      <mat-grid-list cols="3" rowHeight="60px">
        <mat-grid-tile>
          <mat-form-field >
            <input matInput maxlength="10" placeholder="Placa" formControlName="placa" #InputPlaca>
            <mat-hint align="end">{{InputPlaca.value.length}} / 7</mat-hint>
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile>
          <mat-form-field >
            <input matInput maxlength="8" placeholder="DNI" formControlName="dni" #InputDNI>
            <mat-hint align="end">{{InputDNI.value.length}} / 8</mat-hint>
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile>
          <mat-form-field>
            <input matInput maxlength="45" placeholder="Chofer" formControlName="chofer">
          </mat-form-field>
        </mat-grid-tile>
      </mat-grid-list>

   </mat-card>

  </mat-card-content>


<!--Detalle Vendedores    -->

<mat-card-content>

  <mat-card class="CabeceraSalidaVendedor">
    <mat-card-header>
      <mat-card-title>
        Detalle Vendedores
      </mat-card-title>
    </mat-card-header>

   <mat-grid-list cols="1"  rowHeight="55px">
      <mat-grid-tile>
        <button mat-mini-fab type="button" color="primary" matTooltip="Agrega Vendedor" (click)="AgregarVendedor()"><mat-icon>add</mat-icon></button>
      </mat-grid-tile>
    </mat-grid-list>

    <mat-card-subtitle>
      <mat-form-field>
        <input matInput formControlName="comision" [value]="SalidaVendedoresForm.get('comision').value | percent:'1.0-0'">
      </mat-form-field>
    </mat-card-subtitle>

    <div formArrayName="vendedores" *ngFor="let vendedor of SalidaVendedoresForm['controls'].vendedores['controls'];let i = index">
      <div [formGroupName]="i">
        <mat-grid-list cols="3" rowHeight="70px"> 

          <mat-grid-tile>
            <mat-form-field class="formulario-principal">
              <input matInput placeholder="Vendedor" [matAutocomplete]="autovendedor" #InputVendedor formControlName="nombre">
              <mat-autocomplete #autovendedor="matAutocomplete" [displayWith]="displayFn" (optionSelected)="VendedorSeleccionado($event, i)">
                <mat-option *ngFor="let vendedor of Vendedor" [value]="vendedor">
                  {{vendedor.nombre}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </mat-grid-tile>

          <mat-grid-tile>
            <mat-form-field class="formulario-principal">
              <input matInput placeholder="Comision efectiva" formControlName="comision" [value]="SalidaVendedoresForm.get('vendedores')['controls'][i].get('comision').value | percent:'1.0-0'">
            </mat-form-field>
          </mat-grid-tile>

          <!-- Boton elimina Producto -->
          <mat-grid-tile>
            <button mat-mini-fab type="button" color="primary" (click)="EliminarVendedor(i)"><mat-icon>delete</mat-icon></button>
          </mat-grid-tile>
        </mat-grid-list>
      </div>
    </div>
  </mat-card>
</mat-card-content>

<mat-card-content>
   <mat-card class = "CabeceraSalidaVendedor">
    
    <mat-card-header>
      <mat-card-title>
          Detalle de Productos
      </mat-card-title>
    </mat-card-header>

    <mat-grid-list cols="1" rowHeight="55px">
      <mat-grid-tile>
        <button mat-mini-fab type="button" color="primary" matTooltip="Agrega Producto" (click)="AgregarProducto()"><mat-icon>add</mat-icon></button>
      </mat-grid-tile>
    </mat-grid-list>
    
    <mat-card-subtitle>
      <mat-form-field>
        <mat-select placeholder="Selecciona Almacen" #InputAlmacen (selectionChange)="ResetearForm($event)">
          <mat-option *ngFor="let almacen of Almacenes" [value]="almacen.nombre">
            {{almacen.nombre}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </mat-card-subtitle>

    <div formArrayName="productos" *ngFor="let producto of SalidaVendedoresForm['controls'].productos['controls']; let i = index">
      <div [formGroupName]="i">
        <mat-grid-list cols="3" rowHeight="70px">
        
          <mat-grid-tile>
            <mat-form-field class="formulario-principal">
              <input matInput placeholder="Producto" [matAutocomplete]="autoproducto" #InputProducto formControlName="producto">
              <mat-autocomplete #autoproducto="matAutocomplete" [displayWith]="displayFn2" (optionSelected)="ProductoSeleccionado('')">
                <mat-option *ngFor="let producto of Producto" [value]="producto">
                  {{producto.descripcion}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </mat-grid-tile>
        
          <mat-grid-tile>
            <mat-form-field class="formulario-principal">
              <input matInput placeholder="Cantidad" formControlName="cantidad">
            </mat-form-field>
          </mat-grid-tile>
        
          <mat-grid-tile>
            <button mat-mini-fab type="button" color="primary" matTooltip="Agregar series" (click)="AgregarSerieSalidaV(producto.value.producto,i)" [disabled]="!producto.value.producto"><mat-icon>reorder</mat-icon></button>
            <button mat-mini-fab type="button" color="primary" matTooltip="Eliminar producto" (click)="EliminarProducto(producto.value.producto,i)"><mat-icon>delete</mat-icon></button>
          </mat-grid-tile>
        
        </mat-grid-list>
      </div>
    </div>
   </mat-card>
</mat-card-content>

<mat-card-content>
  <mat-card class = "CabeceraSalidaVendedor">
    <mat-card-header>
      <mat-card-title>
        Observaciones
      </mat-card-title>
    </mat-card-header>
    
    <mat-grid-list cols="1" rowHeight="70px">
      <mat-grid-tile>
        <mat-form-field class="formulario-principal">
            <input matInput placeholder="Observaciones" formControlName="observacion">
        </mat-form-field>
      </mat-grid-tile>
    </mat-grid-list>

  </mat-card>
</mat-card-content>

<mat-card-actions>
  <mat-grid-list cols="1" rowHeight="55px">
    <mat-grid-tile>
      <button mat-raised-button type="submit" color="primary" >Grabar</button>
      <button mat-raised-button type="button" color="accent" (click)="openDialog()">Limpiar</button>
    </mat-grid-tile>
    </mat-grid-list>
  </mat-card-actions>

</form>

</mat-card>

